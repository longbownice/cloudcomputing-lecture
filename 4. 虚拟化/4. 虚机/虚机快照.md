# *原理*

虚拟机快照其实就是虚机内存/磁盘信息的快照，主要涉及内存和磁盘。创建虚机快照，需要虚机处于运行态，底层快照操作由libvirt和qemu完成。

# *分类*

## 在线快照(带内存)

​	基本步骤：

1、 创建快照节点

2、 创建原虚机新的叶子节点

3、 将虚机运行的新的叶子节点指向其父节点（虚机原来运行的节点）

4、 将快照节点的父节点指向虚机原先运行的节点

5、 在线快照：带入内存快照保存文件（如果是块设备需要提前准备好），file指定为步骤2创建的虚机新的叶子节点，savefile指定为步骤1创建的快照节点

## 在线磁盘快照(不带内存)

​	基本步骤：

1、 创建快照节点

2、 创建原虚机新的叶子节点

3、 将虚机运行的新的叶子节点指向其父节点（虚机原来运行的节点）

4、 将快照节点的父节点指向虚机原先运行的节点

5、 在线磁盘快照：file指定为步骤2创建的虚机新的叶子节点，snapfile指定为步骤1创建的快照节点

 